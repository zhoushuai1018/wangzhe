;/*!/client/widget/code-login/login-register/loginComponent.js*/
define("passport:widget/code-login/login-register/loginComponent.js",function(require,exports,module){"use strict";var $=require("common:widget/lib/jquery/jquery"),glpbCommon=require("common:node_modules/glpb-components-common/src/ValidateProvider/RRDValidator"),LoginComponent=function(){},LoginSonComponent=function(){},loginPrototype=LoginComponent.prototype;loginPrototype.validateMobile=function(mobile){var vali=glpbCommon.validate;if(this.error="",!mobile)return"请输入手机号";var isMobile=vali.isMobile(mobile);return isMobile?this.error:this.error="请输入正确手机号码"},loginPrototype.validateUserName=function(userName){var vali=glpbCommon.validate;if(this.error="",!userName)return"手机号和邮箱不能为空";var isEmail=vali.isEmail(userName),isMobile=vali.isMobile(userName);return isEmail||isMobile?this.error:this.error="请输入正确邮箱或手机号"},loginPrototype.validateOldPassword=function(password){return this.error="",password?password.length<6?this.error="密码不能小于6位":this.error:"密码不能为空"},loginPrototype.validatePassword=function(password){this.error="";var passw=/^[a-zA-Z]{8,16}$|^[0-9]{8,16}$|^[~!@#$%^&*._]{8,16}$/.test(password),pw=/^[0-9A-Za-z~!@#$%^&*._]{8,16}$/.test(password);return(!pw||passw)&&(this.error="8~16位数字、字母或符号组合"),this.error},loginPrototype.validateImageCode=function(code){return this.error="",code?4!=code.length?this.error="图形验证码必须是4位数":this.error:"图形验证码不能为空"},loginPrototype.validateCode=function(randCode){return this.error="",randCode?4!=randCode.length?this.error="手机验证码必须是4位":this.error:"手机验证码不能为空"},loginPrototype.changeRandCode=function(randImage){var time=(new Date).getTime();$(randImage).attr("src","/passport/index/captcha?time="+time)},loginPrototype.inputChange=function(target){$(target).addClass("blue")},loginPrototype.errorPrompt=function(listDom){if(listDom){var targetName=listDom.tagName,error=this.error;if("LI"===targetName){var errorDom=$(listDom).find(".error-info").text(this.error);error?($(listDom).removeClass("blue").addClass("orange"),errorDom.show()):($(listDom).removeClass("blue").removeClass("orange"),errorDom.hide())}else if("UL"===targetName){var errorDom=$(listDom).find(".last-error").text(this.error);errorDom.show()}else{var errorDom=$(listDom).text(this.error);errorDom.show()}}},LoginSonComponent.prototype=Object.create(loginPrototype),module.exports=new LoginSonComponent});
;/*!/client/widget/code-login/login-register/login-register.js*/
define("passport:widget/code-login/login-register/login-register.js",function(require,exports,module){"use strict";function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}var $=require("common:widget/lib/jquery/jquery"),utils=require("common:widget/ui/utils/utils"),service=(require("common:widget/lib/gt/gt"),require("common:widget/ui/service/service-factory")),passportService=service.getService("passport"),utm=utils.utmsourceUtil,isBorrower=!0,isVoice=0,countdown=10,voiceTimeOut=function(){},loginComment=require("passport:widget/code-login/login-register/loginComponent"),LoginOrRegister=function(){function LoginOrRegister(){_classCallCheck(this,LoginOrRegister)}return LoginOrRegister.prototype.init=function(geetestData,borrower){isBorrower=borrower?!0:!1,this.initGt(geetestData),this.bindEvent(),this.setInputVal()},LoginOrRegister.prototype.initGt=function(geetestData){initGeetest({gt:geetestData.gt,challenge:geetestData.challenge,offline:!geetestData.success,new_captcha:geetestData.new_captcha,product:"bind",width:"300px",pure:1},this.handler.bind(this))},LoginOrRegister.prototype.handler=function(captchaObj){var that=this;captchaObj.onReady(function(){}),captchaObj.onNextReady(function(){}),captchaObj.onClose(function(){}),captchaObj.onError(function(){captchaObj.reset()}),captchaObj.onSuccess(function(){var result=captchaObj.getValidate();if(!result)return that.error="请完成验证",void that.errorModal(-1);var verifData={geetest_challenge:result.geetest_challenge,geetest_validate:result.geetest_validate,geetest_seccode:result.geetest_seccode};that.sendGeetestOrVerification(verifData)}),$(".verification").on("click",function(){var isMobile=that.validateMobileNum();if(!$(".verification").hasClass("is_send")){if(isMobile)return void loginComment.errorPrompt($("#reg_username").parent("li")[0]);var isValidate=$(".verification").hasClass("is_validate");isValidate&&(isVoice=0,that.sendGeetestOrVerification("",captchaObj))}}),$(".voice-button").on("click",function(){var isMobile=that.validateMobileNum();return isMobile?void loginComment.errorPrompt($("#reg_username").parent("li")[0]):(isVoice=1,void that.sendGeetestOrVerification("",captchaObj))})},LoginOrRegister.prototype.sendGeetestOrVerification=function(geetestData,captchaObj){var that=this;if(this.validateMobileNum())return void loginComment.errorPrompt($("#reg_username").parent("li")[0]);if(this.validateIamgeCode())return void loginComment.errorPrompt($(".image_code_show")[0]);var rand=$("#reg_RandCode").val(),userMobile=$("#reg_username").val(),verifData={mobile:this.spaceStrChangeMobile(userMobile),existMobile:1,origin:"PC",channel:"RRD",isBorrower:isBorrower?1:2,isVoice:isVoice||0};geetestData&&(verifData.geetest_challenge=geetestData.geetest_challenge,verifData.geetest_validate=geetestData.geetest_validate,verifData.geetest_seccode=geetestData.geetest_seccode),rand&&(verifData.imgCode=rand),passportService.sendRegisterSmsCode(verifData).then(function(res){var out=res.data;return res.requestStatus!==passportService.STATUS.SUCCESS?Promise.reject(new Error("请稍候重试！")):(loginComment.error=out.message,void(isVoice?that.sendVoiceCodeStatus(out.status,captchaObj):that.sendCodeStatusShow(out,captchaObj)))}).caught(function(){loginComment.error="服务器异常,请稍后再试",loginComment.changeRandCode($("#reg-rand-image")),loginComment.errorPrompt($(".system-text")[0])})},LoginOrRegister.prototype.sendVoiceCodeStatus=function(status,captchaObj){return 0==status?($(".voice-verify").attr("class","voice-verify is-voiceing"),void this.setVoiceTimeOut()):void("3230"==status?(loginComment.changeRandCode($("#reg-rand-image")),$(".image_code_show").show(),loginComment.errorPrompt($(".image_code_show")[0])):"3240"==status?(loginComment.changeRandCode($("#reg-rand-image")),loginComment.errorPrompt($(".image_code_show")[0])):1==status?(loginComment.changeRandCode($("#reg-rand-image")),loginComment.errorPrompt($(".image_code_show")[0])):"940002"==status?(loginComment.changeRandCode($("#reg-rand-image")),loginComment.errorPrompt($("#reg_username").parent("li")[0])):"930001"==status?captchaObj.verify():"930002"==status?(loginComment.changeRandCode($("#reg-rand-image")),$(".image_code_show").show(),loginComment.errorPrompt($(".image_code_show")[0])):(loginComment.errorPrompt($(".system-text")[0]),loginComment.changeRandCode($("#reg-rand-image"))))},LoginOrRegister.prototype.sendCodeStatusShow=function(out,captchaObj){var status=out.status;if(0==status){var data=out.data;return countdown=data.countdown,void this.setIntervalFun()}"3230"==status?(loginComment.changeRandCode($("#reg-rand-image")),$(".image_code_show").show(),loginComment.errorPrompt($(".image_code_show")[0])):"3240"==status?(loginComment.changeRandCode($("#reg-rand-image")),loginComment.errorPrompt($(".image_code_show")[0])):1==status?(loginComment.changeRandCode($("#reg-rand-image")),loginComment.errorPrompt($(".image_code_show")[0])):"940002"==status?(loginComment.changeRandCode($("#reg-rand-image")),loginComment.errorPrompt($("#reg_username").parent("li")[0])):"930001"==status?captchaObj.verify():"930002"==status?(loginComment.changeRandCode($("#reg-rand-image")),$(".image_code_show").show(),loginComment.errorPrompt($(".image_code_show")[0])):(loginComment.errorPrompt($(".system-text")[0]),loginComment.changeRandCode($("#reg-rand-image")))},LoginOrRegister.prototype.doRegister=function(){var _this2=this,userMobile=$("#reg_username").val(),formData={mobile:this.spaceStrChangeMobile(userMobile),smsCode:$("#reg_verif").val(),intention:$("#intention").val(),type:$("#regRandCode").val(),id:$("#regId").val(),inviteCode:$("#regInviteCode").val(),registerSource:$("#regRegisterSource").val(),utmSource:$("#regPromotion").val(),platform:"PC",channel:"RRD",rememberme:"on",targetUrl:$("#regTargetUrl").val(),returnUrl:$("#regReturnUrl").val()},utmSourceInUrl=utm.getUtmSourceBySearch();utmSourceInUrl&&(formData.utmSource=utmSourceInUrl);var utmCookieParams=utm.getAllUtmCookies(),urlSearchParams=utils.getSearchConf(),finalPostData=$.extend({},utmCookieParams,urlSearchParams,formData);delete finalPostData.utm_source;var loginRegisterUrl="doLoginRegister";isBorrower&&(loginRegisterUrl="doBorrowerLoginRegister"),isBorrower?this.sendRegisterReq(loginRegisterUrl,finalPostData,isBorrower):$(".login-index").data("riskDialog")===!0?passportService.checkUserByMobile({mobile:formData.mobile}).then(function(res){var _this=_this2;if(80004===res.data.status){var Popup=_this2.detailPopup();new Popup({type:"RISK",id:"risk",data:{msg:res.data.data.body},submitCallback:function(){_this.sendRegisterReq(loginRegisterUrl,finalPostData,isBorrower)}}).show()}else _this.sendRegisterReq(loginRegisterUrl,finalPostData,isBorrower)}):this.sendRegisterReq(loginRegisterUrl,finalPostData,isBorrower)},LoginOrRegister.prototype.sendRegisterReq=function(loginRegisterUrl,finalPostData,isBorrower){passportService[loginRegisterUrl](finalPostData).then(function(res){if(res.requestStatus!==passportService.STATUS.SUCCESS)return loginComment.error=res.data.message||"请求后端服务出错, 请稍后再试",loginComment.errorPrompt($(".system-text")[0]),Promise.reject(new Error(msg));var out=res.data;return 0!==out.status?80023===out.status?(loginComment.error=out.message,void loginComment.errorPrompt($("#reg_username").parent("li")[0])):80006===out.status?(loginComment.error=out.message,void loginComment.errorPrompt($("#reg_verif").parent("li")[0])):80027===out.status?(loginComment.error=out.message,void loginComment.errorPrompt($("#reg_verif").parent("li")[0])):(loginComment.error=out.message,void loginComment.errorPrompt($(".system-text")[0])):void(isBorrower?location.replace(out.data.jumpURL):location.href=out.data.jumpURL)}).caught(function(event){loginComment.error=event.message||"请求后端服务出错, 请稍后再试",loginComment.errorPrompt($(".system-text")[0])})},LoginOrRegister.prototype.bindEvent=function(){var that=this;$(".login-register li").on("blur","input",function(){$(this).parent("li").removeClass("blue");var className=$(this).attr("class"),val=$(this).val(),error="";"mobile"===className?(val=that.spaceStrChangeMobile(val),error=loginComment.validateMobile(val)):"code"===className?error=loginComment.validateImageCode(val):"mobile_code"===className&&(error=loginComment.validateCode(val));var listDom=$(this).parent("li")[0];loginComment.errorPrompt(listDom)}),$(".login-register ul").on("keyup","input",function(){var isAllow=that.buttonChange()||"";isAllow?$(".button-submit button").addClass("is-allow"):$(".button-submit button").removeClass("is-allow")}),$(".login-register ul").on("input","#reg_username",function(){var _this3=this,val=$(this).val()||"";if(val=that.mobileAddSpace(val),$(this).val(val),this.createTextRange){var rg=this.createTextRange();rg.collapse(!1),rg.select()}else this.setSelectionRange&&!function(){var th=_this3;setTimeout(function(){var len=th.value.length;th.setSelectionRange(len,len)},20)}()}),$(".login-register li").on("focus","input",function(){$(this).parent("li").removeClass("orange"),$(this).parent("li").find(".error-info").hide();var isAllow=that.buttonChange();isAllow?$(".button-submit button").addClass("is-allow"):$(".button-submit button").removeClass("is-allow")}),$(".login-register").on("click","#reg-rand-image",function(){loginComment.changeRandCode($("#reg-rand-image"))}),$(".login-register").on("click",".is-allow",this.doRegister.bind(this)),$("#rememberme").on("click",function(){$(this).hasClass("is-choose")?$(this).attr("class","no-choose"):$(this).attr("class","is-choose");var isAllow=that.buttonChange();isAllow?$(".button-submit button").addClass("is-allow"):$(".button-submit button").removeClass("is-allow")}),$(".borrower-entrance img").on("click",function(){isBorrower=!isBorrower,isBorrower?($(".borrower-entrance .text").text("我是借款人"),$(".borrower-change span").text("登录"),$(".lend-login .tab-password").hide()):($(".borrower-entrance .text").text("我是出借人"),$(".borrower-change span").text("登录/注册"),$(".lend-login .tab-password").show())})},LoginOrRegister.prototype.spaceStrChangeMobile=function(str){return str+="",str=str.replace(/\ +/g,"")},LoginOrRegister.prototype.mobileAddSpace=function(mobile){mobile=this.spaceStrChangeMobile(mobile);var one="",two="",three="";return one=mobile.slice(0,3),two=mobile.slice(3,7),two=two?" "+two:two,three=mobile.slice(7,11),three=three?" "+three:three,mobile=one+two+three},LoginOrRegister.prototype.validateMobileNum=function(){var userName=this.spaceStrChangeMobile($("#reg_username").val()||""),userNameError=loginComment.validateMobile(userName);return userNameError?!0:!1},LoginOrRegister.prototype.validateIamgeCode=function(){var code=$("#reg_RandCode").val(),isHide=$(".image_code_show").is(":hidden"),codeError="";return isHide||(codeError=loginComment.validateImageCode(code)),codeError?!0:!1},LoginOrRegister.prototype.validateSendCode=function(){var mobileCode=$("#reg_verif").val(),mobileCodeError=loginComment.validateCode(mobileCode);return mobileCodeError?!0:!1},LoginOrRegister.prototype.buttonChange=function(){var userName=this.spaceStrChangeMobile($("#reg_username").val()||""),code=$("#reg_RandCode").val(),isHide=$(".image_code_show").is(":hidden"),mobileCode=$("#reg_verif").val(),codeError="",userNameError=loginComment.validateMobile(userName),mobileCodeError=loginComment.validateCode(mobileCode),isCheckProtol=$("#rememberme").hasClass("is-choose");return isHide||(codeError=loginComment.validateImageCode(code)),codeError||userNameError||mobileCodeError||!isCheckProtol?!1:!0},LoginOrRegister.prototype.setVoiceTimeOut=function(){voiceTimeOut=setTimeout(function(){$(".voice-verify").attr("class","voice-verify is-voice")},3e4)},LoginOrRegister.prototype.setIntervalFun=function(){var time=60,dom=$(".verification");dom.addClass("is_send").text(time+"s后重新获取"),dom.removeClass("is_validate");var timer=setInterval(function(){time--,0>=time?(dom.text("重新发送").removeClass("is_send"),dom.addClass("is_validate"),clearInterval(timer)):dom.text(time+"s后重新获取")},1e3);if($(".voice-verify").attr("class","voice-verify"),clearTimeout(voiceTimeOut),!isBorrower){var countDownTime=1e3*parseInt(countdown);setTimeout(function(){$(".voice-verify").attr("class","voice-verify is-voice")},countDownTime)}},LoginOrRegister.prototype.setInputVal=function(){var urlSearchParams=utils.getSearchConf(),promotion=urlSearchParams.utm_source||urlSearchParams.utmSource||null,utm=utils.utmsourceUtil;null==promotion&&(promotion=utm.getCookie("promotion")||utm.getCookie("utmSource")),null!=promotion&&promotion.match("[-a-zA-Z0-9?=_/]{1,32}")?utm.setCookie("promotion_source",promotion,365):promotion=utm.getCookie("promotion_source");var id=utm.getId(),inviteCode=utm.getInviteCode(),getRegisterSource=utm.getRegisterSource();$("#regRegisterSource").val(getRegisterSource),$("#regId").val(id),$("#regPromotion").val(promotion),$("#regInviteCode").val(inviteCode),$("#intention").val("LENDER")},LoginOrRegister.prototype.detailPopup=function(){var DetailPopup=function(){var options=arguments[0]||{};this.type=options.type,this.data=options.data,this.id=options.id,this.submit=options.submitCallback,this.modal=createModal.call(this),initializeEvents.call(this)};DetailPopup.prototype.show=function(){this.modal.style.display="block",modifyTemplateStyle(this.id)},DetailPopup.prototype.hide=function(){this.modal.style.display="none",this.modal.parentNode.removeChild(this.modal),this.modal=null};var createModal=function(){var oDiv=document.createElement("div");oDiv.className="detail-modal-main",this.id&&(oDiv.id=this.id),oDiv.innerHTML=createTemplate(this.type,this.data);var root=document.getElementsByTagName("body")[0];return root.appendChild(oDiv),oDiv},createTemplate=function(type,data){var config=templateConfig(type),tpl=config.tpl(data);return'<div class="detail-modal-shadow"></div>'+tpl},templateConfig=function(modalType){var tplMap={RISK:{tpl:riskTemplate},NORMAL:{tpl:normalTemplate}};return tplMap[modalType]},riskTemplate=function(data){return'\n                <div class="risk-modal-form">\n                   <div class="header">\n                       <span class="dialog-close-btn J-detail-close">×</span>\n                   </div>\n                   <div class="msg">'+data.msg+'</div>\n                   <div class="button-group">\n                       <div class="close J-detail-close">放弃注册</div>\n                       <div class="submit J-detail-submit">我知道了</div>\n                    </div>\n                </div>\n            '},normalTemplate=function(data){return'\n                    <div class="modal-form normal-modal">\n                        <div class="header">\n                            <span class="title">'+data.title+'</span>\n                            <span class="dialog-close-btn J-detail-close">×</span>\n                        </div>\n                        <div class="msg">'+data.msg+"</div>\n                    </div>\n                    "},initializeEvents=function(){var _this=this,submitBtn=$(".J-detail-submit"),closeBtn=[$(".J-detail-cancel"),$(".J-detail-close")];submitBtn.on("click",function(){_this.submit&&_this.submit(),_this.hide()}),closeBtn.forEach(function(item){item.on("click",function(){_this.cancel&&_this.cancel(),_this.hide()})})},modifyTemplateStyle=function(id){var modal=null;modal=$(id?"#"+id+" .risk-modal-form":".detail-modal-main .modal-form");var topOffset=($(window).height()-modal.height())/2+$(window).scrollTop();topOffset=0>topOffset?0:topOffset,modal.css({top:topOffset})};return DetailPopup},LoginOrRegister}();module.exports=new LoginOrRegister});
;/*!/client/widget/code-login/password-login/password-login.js*/
define("passport:widget/code-login/password-login/password-login.js",function(require,exports,module){"use strict";function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}var $=require("common:widget/lib/jquery/jquery"),handlebars=require("common:widget/lib/handlebars/handlebars"),MailSuggest=require("common:widget/ui/mailSuggest/mailSuggest"),glpbUtils=require("common:node_modules/glpb-components-common/src/index"),loginComment=require("passport:widget/code-login/login-register/loginComponent"),service=require("common:widget/ui/service/service-factory"),passportService=service.getService("passport"),PasswordLogin=function(){function PasswordLogin(){_classCallCheck(this,PasswordLogin);var source=$("#email-suggest-template").html();this.template=handlebars.compile(source),this.$suggest=$('<div class="suggest-login" id="suggest" ></div>').appendTo($("body")),this.$pass=$("#J_pass_input"),this.suggest=new MailSuggest,this.$input=$("#login_username"),this.doLogin=this.doLogin.bind(this)}return PasswordLogin.prototype.init=function(){this.userNameSuggest(),this.bindEvent(),this.initUserName()},PasswordLogin.prototype.bindEvent=function(){var that=this;$(".password-login li").on("focusout","input",function(){var _this=this;setTimeout(function(){$(_this).parent("li").removeClass("blue");var className=$(_this).attr("class"),val=$(_this).val(),error="";"mobile"===className?(val=that.spaceStrChangeMobile(val),error=loginComment.validateUserName(val)):"code"===className?error=loginComment.validateImageCode(val):"login-passwd"===className&&(error=loginComment.validateOldPassword(val));var listDom=$(_this).parent("li")[0];loginComment.errorPrompt(listDom)},100)}),$(".password-login ul").on("keyup","input",function(){var isAllow=that.buttonChange();isAllow?$(".password-login .button-block button").addClass("is-allow"):$(".password-login .button-block button").removeClass("is-allow")}),$(".password-login li").on("focus","input",function(){$(this).parent("li").removeClass("orange"),$(this).parent("li").find(".error-info").hide();var isAllow=that.buttonChange();isAllow?$(".password-login .button-block button").addClass("is-allow"):$(".password-login .button-block button").removeClass("is-allow")}),$(".password-login ul").on("input","#login_username",function(){var _this2=this,val=$(this).val()||"";if(val=that.mobileAddSpace(val),$(this).val(val),this.createTextRange){var rg=this.createTextRange();rg.collapse(!1),rg.select()}else this.setSelectionRange&&!function(){var th=_this2;setTimeout(function(){var len=th.value.length;th.setSelectionRange(len,len)},20)}()}),$("#rememberme-login").on("click",function(){$(this).hasClass("is-choose")?$(this).attr("class","no-choose"):$(this).attr("class","is-choose");var isAllow=that.buttonChange();isAllow?$(".password-login .button-block button").addClass("is-allow"):$(".password-login .button-block button").removeClass("is-allow")}),$(".password-login").on("click","#login-rand-image",function(){loginComment.changeRandCode($("#login-rand-image"))}),$(".password-login").on("click",".is-allow",this.doLogin)},PasswordLogin.prototype.initUserName=function(){var val=$("#login_username").val()||"";val=this.mobileAddSpace(val),$("#login_username").val(val)},PasswordLogin.prototype.spaceStrChangeMobile=function(str){return str+="",str=str.replace(/\ +/g,"")},PasswordLogin.prototype.mobileAddSpace=function(mobile){mobile=this.spaceStrChangeMobile(mobile);var myRe=/^[0-9]{4,11}$/g,isNum=myRe.test(mobile),newMobile="";if(isNum){if(mobile)for(var i=1;i<=mobile.length;i++)newMobile+=i%4===0?" "+mobile[i-1]:mobile[i-1]}else newMobile=mobile;return newMobile},PasswordLogin.prototype.doLogin=function(){var password=glpbUtils.rsaCrypt($("#J_pass_input").val()),userName=this.spaceStrChangeMobile($("#login_username").val()),formData={j_username:userName,j_password:password,j_code:$("#captcha_code").val(),rememberme:"on",targetUrl:$("#targetUrl").val(),returnUrl:$("#returnUrl").val()};passportService.doLogin(formData).then(function(res){var data=res.data,status=data.status;if(0==status)location.href=data.data.jumpURL;else if(data.data.isShowCaptcha?($(".rand_code_show").show("input-hide"),loginComment.changeRandCode($("#login-rand-image"))):$(".rand_code_show").hide("input-hide"),loginComment.error=data.message,"80016"==status){var listDom=$("#J_pass_input").parent("li")[0];loginComment.errorPrompt(listDom)}else"80003"==status?loginComment.errorPrompt($("#login_username").parent("li")[0]):"950001"==status?(loginComment.errorPrompt($(".rand_code_show")[0]),loginComment.changeRandCode($("#login-rand-image"))):"80026"==status?(loginComment.error="您还未设置登录密码，请尝试短信登录",loginComment.errorPrompt($(".password-login ul")[0]),loginComment.changeRandCode($("#login-rand-image"))):(loginComment.errorPrompt($(".password-login ul")[0]),loginComment.changeRandCode($("#login-rand-image")))})},PasswordLogin.prototype.buttonChange=function(){var userName=this.spaceStrChangeMobile($("#login_username").val()),code=$("#captcha_code").val(),isHide=$(".rand_code_show").is(":hidden"),password=$("#J_pass_input").val(),codeError="",userNameError=loginComment.validateUserName(userName),passwordError=loginComment.validateOldPassword(password);isHide||(codeError=loginComment.validateImageCode(code));var isCheckProtol=$("#rememberme-login").hasClass("is-choose");return codeError||userNameError||passwordError||!isCheckProtol?!1:!0},PasswordLogin.prototype.userNameSuggest=function(){var _this3=this,that=this;this.suggestPostion(this.$suggest),$("#login_username").on("keyup",function(e){_this3.emailKeyUp(e)}).on("keydown",function(e){13==e.keyCode&&e.preventDefault()}).on("focusout",function(){setTimeout(function(){that.$suggest.hide()},500)}),this.$suggest.on("mouseenter","li",function(){$(this).addClass("cur")}).on("mouseleave","li",function(){$(this).removeClass("cur").siblings().removeClass("cur")}).on("click","li",function(){var $cur=that.$suggest.find(".cur"),text=that.spaceStrChangeMobile($cur.text());$("#login_username").val(text),that.$suggest.hide(),that.$pass.trigger("focus")}),$("#J_pass_input").on("keyup",function(e){_this3.keyUpEnter(e)}),$("#captcha_code").on("keyup",function(e){_this3.keyUpEnter(e)})},PasswordLogin.prototype.suggestPostion=function(obj){var $input=$("#login_username"),res={};res.left=$input.offset().left,res.top=$input.offset().top+$input.innerHeight()+10,obj.css({left:res.left,top:res.top,absolute:"position"})},PasswordLogin.prototype.keyUpEnter=function(e){var that=this,keyCode=e.keyCode;if(13==keyCode){var isAllow=that.buttonChange(),className=$(".password-login .button-block button").hasClass("is-allow");isAllow&&className&&that.doLogin()}},PasswordLogin.prototype.keyDownUp=function(obj,type){var $cur=this.$suggest.find(".cur"),index=$cur.index(),len=this.$suggest.find("li").length;if("down"==type)index++,index>len-1&&(index=0),this.$suggest.find("li").removeClass("cur").eq(index).addClass("cur");else if("up"==type)index--,0>index&&(index=len-1),this.$suggest.find("li").removeClass("cur").eq(index).addClass("cur");else if("enter"==type){var text=$cur.text();text=this.spaceStrChangeMobile(text),$("#login_username").val(text).focus(),this.$suggest.hide(),this.$pass.trigger("focus")}},PasswordLogin.prototype.emailKeyUp=function(e){$("#login_username").parent("li").removeClass("orange"),this.suggestPostion(this.$suggest);var email=$("#login_username").val();switch(e.keyCode){case 38:this.keyDownUp($(this),"up");break;case 40:this.keyDownUp($(this),"down");break;case 13:this.keyDownUp($(this),"enter");break;default:if(!email.length)return void this.$suggest.hide();var result=this.suggest.run(email);/^\d{1,11}$/g.test(email.replace(/\s+/g,""))&&(result.remove=!0);var html=this.template(result);this.$suggest.html(html).show().find("li").eq(0).addClass("cur")}},PasswordLogin}();module.exports=new PasswordLogin});
;/*!/client/widget/login/login-form/login-form.js*/
define("passport:widget/login/login-form/login-form.js",function(require,exports,module){"use strict";function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}var $=require("common:widget/lib/jquery/jquery"),handlebars=(require("common:widget/ui/utils/utils"),require("common:widget/lib/handlebars/handlebars")),MailSuggest=require("common:widget/ui/mailSuggest/mailSuggest"),glpbUtils=require("common:node_modules/glpb-components-common/src/index"),glpbCommon=require("common:node_modules/glpb-components-common/src/ValidateProvider/RRDValidator"),service=require("common:widget/ui/service/service-factory"),passportService=service.getService("passport"),LoginForm=function(){function LoginForm(){_classCallCheck(this,LoginForm);var source=$("#email-suggest-template").html();this.template=handlebars.compile(source),this.$suggest=$('<div class="suggest" id="suggest" ></div>').appendTo($("body")),this.$pass=$("#J_pass_input"),this.suggest=new MailSuggest,this.$input=$("#j_username"),this.error="账号密码不能为空";var he=$(".login-ul").height();this.validateCode=195==he?!1:!0}return LoginForm.prototype.init=function(){var _this=this,that=this;this.suggestPostion(this.$suggest),$(".j-checkbox").on("click",function(e){_this.checked(e)}),$("input[type=submit]").click(function(){_this.submitHandler()}),$("#randImage").click(function(){_this.changeRandCode()}),$("#randCode").keyup(function(){_this.validateRandCode()}),$("#j_username").on("keyup",function(e){_this.emailKeyUp(e)}).on("keydown",function(e){13==e.keyCode&&e.preventDefault()}).on("focusout",function(){setTimeout(function(){that.$suggest.hide()},500)}),this.$suggest.on("mouseenter","li",function(){$(this).addClass("cur")}).on("mouseleave","li",function(){$(this).removeClass("cur").siblings().removeClass("cur")}).on("click","li",function(){that.keyDownUp($("#j_username"),"enter"),that.$pass.trigger("focus")}),$("#J_pass_input").on("keyup",function(e){_this.keyUpEnter(e)}),$("#randCode").on("keyup",function(e){_this.keyUpEnter(e)})},LoginForm.prototype.keyUpEnter=function(e){var that=e.target;$(that).parent().removeClass("orange");var keyCode=e.keyCode;13==keyCode&&this.submitHandler()},LoginForm.prototype.checked=function(e){var that=e.currentTarget;$(that).hasClass("j-checked")?($(that).removeClass("j-checked"),$(that).find("input").prop("checked",!1)):($(that).addClass("j-checked"),$(that).find("input").prop("checked",!0))},LoginForm.prototype.buttonLoading=function(num){1==num?($(".submit .login-btn").val(""),$(".submit img").show()):($(".submit .login-btn").val("立即登录"),$(".submit img").hide())},LoginForm.prototype.submitHandler=function(){var _this2=this;if(this.buttonLoading(1),this.validate())return void this.buttonLoading(2);if(!this.validateCode)return this.error="验证码错误",this.errorModal(2),void this.buttonLoading(2);var rememberme=$("#rememberme").is(":checked")?"on":"";if("on"!=rememberme)return this.error="请同意我们的服务协议",this.errorModal(-1),void this.buttonLoading(2);var that=this,password=glpbUtils.rsaCrypt($("#J_pass_input").val()),formData={j_username:$("#j_username").val(),j_password:password,j_code:$("#randCode").val(),rememberme:"on",targetUrl:$("#targetUrl").val(),returnUrl:$("#returnUrl").val()};passportService.doLogin(formData).then(function(res){if(res.requestStatus===passportService.STATUS.ERROR)return _this2.buttonLoading(2),!0;var data=res.data;if(0==data.status)location.href=data.data.jumpURL;else{data.data.isShowCaptcha?($(".input-hide").removeClass("input-hide"),$(".login-ul").animate({height:"195px"}),that.changeRandCode()):($(".validate-image").addClass("input-hide"),$(".login-ul").animate({height:"130px"}));var num="",_status=data.status;"80016"==_status&&(num=1),"80003"==_status&&(num=0),"950001"==_status&&(num=2),that.error=data.message,that.errorModal(num),_this2.buttonLoading(2)}})},LoginForm.prototype.validateRandCode=function(){var params={j_code:$("#randCode").val()},that=this;passportService.captchaValidate(params).then(function(res){if(res.requestStatus===passportService.STATUS.ERROR)return!0;var status=res.data.status;that.validateCode=0==status?!0:!1})},LoginForm.prototype.changeRandCode=function(){var time=(new Date).getTime();$("#randImage").attr("src","/passport/index/captcha?time="+time)},LoginForm.prototype.validate=function(){var vali=glpbCommon.validate,userName=$("#j_username").val(),password=$("#J_pass_input").val();if(!userName)return this.error="手机号和邮箱不能为空",this.errorModal(0),!0;var isEmail=vali.isEmail(userName),isMobile=vali.isMobile(userName);return isEmail||isMobile?password?void 0:(this.error="密码不能为空",this.errorModal(1),!0):(this.error="请输入正确的邮箱地址或手机号码",this.errorModal(0),!0)},LoginForm.prototype.errorModal=function(num){$(".login-error").text(this.error),$(".login-error").fadeIn(2e3,function(){setTimeout(function(){$(".login-error").fadeOut(2e3)},2e3)}),num>=0&&$(".login-ul li").eq(num).addClass("orange").siblings("li").removeClass("orange")},LoginForm.prototype.suggestPostion=function(obj){var $input=$("#j_username"),res={};res.left=$input.offset().left,res.top=$input.offset().top+$input.innerHeight(),obj.css({left:res.left,top:res.top,absolute:"position"})},LoginForm.prototype.keyDownUp=function(obj,type){var $cur=this.$suggest.find(".cur"),index=$cur.index(),len=this.$suggest.find("li").length;"down"==type?(index++,index>len-1&&(index=0),this.$suggest.find("li").removeClass("cur").eq(index).addClass("cur")):"up"==type?(index--,0>index&&(index=len-1),this.$suggest.find("li").removeClass("cur").eq(index).addClass("cur")):"enter"==type&&($("#j_username").val($cur.text()).blur(),this.$suggest.hide(),this.$pass.trigger("focus"))},LoginForm.prototype.emailKeyUp=function(e){$("#j_username").parent("li").removeClass("orange"),this.suggestPostion(this.$suggest);var email=$("#j_username").val();switch(e.keyCode){case 38:this.keyDownUp($(this),"up");break;case 40:this.keyDownUp($(this),"down");break;case 13:this.keyDownUp($(this),"enter");break;default:if(!email.length)return void this.$suggest.hide();var result=this.suggest.run(email);/^\d{1,}$/g.test(email)&&(result.remove=!0);var html=this.template(result);this.$suggest.html(html).show().find("li").eq(0).addClass("cur")}},LoginForm}();module.exports=new LoginForm});
;/*!/client/widget/login/register-form/register-form.js*/
define("passport:widget/login/register-form/register-form.js",function(require,exports,module){"use strict";function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}var $=require("common:widget/lib/jquery/jquery"),utils=require("common:widget/ui/utils/utils"),glpbUtils=require("common:node_modules/glpb-components-common/src/index"),glpbCommon=require("common:node_modules/glpb-components-common/src/ValidateProvider/RRDValidator"),service=require("common:widget/ui/service/service-factory"),passportService=(service.getService("home"),service.getService("passport")),statistic=require("common:widget/ui/statistic/statistic"),utm=(require("common:widget/lib/gt/gt"),utils.utmsourceUtil),RegForm=function(){function RegForm(){_classCallCheck(this,RegForm),this.error="不能为空",this.seconds=60,this.sendTimes=0,this.randCode=!1}return RegForm.prototype.init=function(geetestData,isGeetest){this.setInputVal();var that=this;isGeetest?this.initGt(geetestData):$(".verification").on("click",function(){that.sendVerification()}),$(".reg-btn").on("click",function(){that.sendReg()}),$(".reg-ul li input").keyup(function(e){that.hideOrangeLine(e)}),$(".rand-code").on("click",function(){that.rankCodeReload()}),this.initPvUv()},RegForm.prototype.initPvUv=function(){var query=window.location.pathname,arr=query.split("/");arr.reverse();var login=arr[0],eventId="PC_enter_login";"register"==login&&(eventId="PC_enter_register"),statistic.eventRaw({eventId:eventId})},RegForm.prototype.hideOrangeLine=function(e){var that=e.target;$(that).parent("li").removeClass("orange")},RegForm.prototype.sendReg=function(){var that=this;if(!(that.validateMoblie()||that.validateCode()||that.validatePassword()||that.validateMobileCode())){that.buttonLoading(1);var password=glpbUtils.rsaCrypt($("#reg_password").val()),formData={username:$("#reg_username").val(),password:password,mobileCode:$("#reg_verif").val(),intention:$("#intention").val(),type:$("#regRandCode").val(),id:$("#regId").val(),inviteCode:$("#regInviteCode").val(),registerSource:$("#regRegisterSource").val(),utmSource:$("#regPromotion").val(),agree:"on",platform:"PC",channel:"false"==window.tplConf._isWeCom?"RRD":"WE"},utmSourceInUrl=utm.getUtmSourceBySearch();utmSourceInUrl&&(formData.utmSource=utmSourceInUrl);var utmCookieParams=utm.getAllUtmCookies(),urlSearchParams=utils.getSearchConf(),finalPostData=$.extend({},utmCookieParams,urlSearchParams,formData);delete finalPostData.utm_source,passportService.doRegister(finalPostData).then(function(res){if(res.requestStatus!==passportService.STATUS.SUCCESS){var msg=res.data.message||"请求后端服务出错, 请稍后再试";return that.zhugeFail(msg),Promise.reject(new Error(msg))}!function(){var out=res.data;0===out.status?statistic.eventRaw({eventId:"pc_reg_success",extra:{url:location.href},callback:function(){location.href=out.data.jumpURL}}):3310===out.status?(that.zhugeFail(out.message),that.error=out.message,that.errorModal(2),that.rankCodeReload(),that.buttonLoading(2)):3320===out.status?(that.zhugeFail(out.message),that.error=out.message,that.errorModal(0),that.rankCodeReload(),that.buttonLoading(2)):3330===out.status?(that.zhugeFail(out.message),that.error=out.message,that.errorModal(3),that.rankCodeReload(),that.buttonLoading(2)):(that.zhugeFail(out.message),that.error=out.message,that.errorModal(-1),that.rankCodeReload(),that.buttonLoading(2))}()}).caught(function(event){that.zhugeFail(event.message),that.error=event.message,that.errorModal(-1),that.rankCodeReload(),that.buttonLoading(2)})}},RegForm.prototype.zhugeFail=function(mess){statistic.event({eventId:"pc_reg_failed",extra:{"失败原因":mess}})},RegForm.prototype.buttonLoading=function(num){1==num?($(".reg-submit .reg-btn").val(""),$(".reg-submit img").show()):($(".reg-submit .reg-btn").val("注册领优惠券"),$(".reg-submit img").hide())},RegForm.prototype.setInputVal=function(){var urlSearchParams=utils.getSearchConf(),promotion=urlSearchParams.utm_source||urlSearchParams.utmSource||null,utm=utils.utmsourceUtil;null==promotion&&(promotion=utm.getCookie("promotion")||utm.getCookie("utmSource")),null!=promotion&&promotion.match("[-a-zA-Z0-9?=_/]{1,32}")?utm.setCookie("promotion_source",promotion,365):promotion=utm.getCookie("promotion_source");var id=utm.getId(),inviteCode=utm.getInviteCode(),getRegisterSource=utm.getRegisterSource();$("#regRegisterSource").val(getRegisterSource),$("#regId").val(id),$("#regPromotion").val(promotion),$("#regInviteCode").val(inviteCode),$("#intention").val("LENDER")},RegForm.prototype.validateMoblie=function(){var vali=glpbCommon.validate,userName=$("#reg_username").val();if(!userName)return this.error="手机号不能为空",this.errorModal(0),!0;var isMobile=vali.isMobile(userName);return isMobile?void 0:(this.error="请输入正确的手机号码",this.errorModal(0),!0)},RegForm.prototype.validateMobileCode=function(){var agree=$(".reg-agree .j-checkbox").hasClass("j-checked");return agree?void 0:(this.error="请同意我们的服务协议",this.errorModal(-1),!0)},RegForm.prototype.validateCode=function(){var randCode=$("#reg_verif").val();return randCode?4!=randCode.length?(this.error="手机验证码必须是4位数",this.errorModal(2),!0):void 0:(this.error="手机验证码不能为空",this.errorModal(2),!0)},RegForm.prototype.rankCodeReload=function(){var time=(new Date).getTime();$("#reg-rand-image").attr("src","/passport/index/captcha?time="+time),this.randCode=!1},RegForm.prototype.setIntervalFun=function(){var time=60,dom=$(".verification");dom.addClass("is_send").text("重新发送("+time+")"),dom.removeClass("is_validate");var timer=setInterval(function(){time--,0>=time?(dom.text("重新发送").removeClass("is_send"),dom.addClass("is_validate"),clearInterval(timer)):dom.text("重新发送("+time+")")},1e3)},RegForm.prototype.sendGeetestVerification=function(verifData){var that=this;$(".verification").hasClass("is_send")||that.validateMoblie()||(passportService.sendRegisterSms(verifData).then(function(res){var out=res.data;if(res.requestStatus===passportService.STATUS.SUCCESS){if(0==out.status)return that.setIntervalFun(),void that.sendTimes++;that.error=out.message,that.errorModal(-1)}}).caught(function(){that.error="服务器异常,请稍后再试",that.errorModal(-1)}),statistic.eventRaw({eventId:"PC_click_get_message"}))},RegForm.prototype.sendVerification=function(){var that=this;if($(".verification").hasClass("is_validate")&&!that.validateMoblie()){var rand=$("#reg_RandCode").val(),verifData={mobile:$("#reg_username").val()};verifData.channel="RRD","true"==window.tplConf._isWeCom&&(verifData.channel="WE"),rand&&(verifData.imgCode=rand),passportService.sendRegisterSms(verifData).then(function(res){var out=res.data;return res.requestStatus!==passportService.STATUS.SUCCESS?Promise.reject(new Error("请稍候重试！")):0==out.status?(that.setIntervalFun(),void that.sendTimes++):void("3230"==out.status?($(".rand_code_show").show(),that.error=out.message,that.errorModal(1)):"3240"==out.status?(that.rankCodeReload(),that.error="验证码不正确",that.errorModal(1)):(that.error=out.message,that.rankCodeReload(),that.errorModal(-1)))}).caught(function(){that.rankCodeReload(),that.error="服务器异常,请稍后再试",that.errorModal(-1)}),statistic.eventRaw({eventId:"PC_click_get_message"})}},RegForm.prototype.validatePassword=function(){var password=$("#reg_password").val(),passw=/^[a-zA-Z]{8,16}$|^[0-9]{8,16}$|^[~!@#$%^&*._]{8,16}$/.test(password),pw=/^[0-9A-Za-z~!@#$%^&*._]{8,16}$/.test(password);return!pw||passw?(this.error="密码为8~16位数字、字母或符号组合",this.errorModal(3),!0):void 0},RegForm.prototype.validateRandCode=function(){var params={j_code:$("#randCode").val()},that=this;passportService.captchaValidate(params).then(function(res){if(res.requestStatus===passportService.STATUS.ERROR)return!0;var status=res.data.status;that.validateCode=0==status?!0:!1})},RegForm.prototype.initGt=function(geetestData){initGeetest({gt:geetestData.gt,challenge:geetestData.challenge,offline:!geetestData.success,new_captcha:geetestData.new_captcha,product:"bind",width:"300px",pure:1},this.handler.bind(this))},RegForm.prototype.handler=function(captchaObj){var that=this;captchaObj.onReady(function(){$("#wait").hide()}),captchaObj.onNextReady(function(){$(".loading-img").hide()}),captchaObj.onClose(function(){$(".loading-img").hide()}),captchaObj.onError(function(){$(".loading-img").hide(),captchaObj.reset()}),captchaObj.onSuccess(function(){$(".loading-img").hide();var result=captchaObj.getValidate();if(!result)return that.error="请完成验证",void that.errorModal(-1);var channel="true"==window.tplConf._isWeCom?"WE":"RRD",verifData={channel:channel,mobile:$("#reg_username").val(),geetest_challenge:result.geetest_challenge,geetest_validate:result.geetest_validate,geetest_seccode:result.geetest_seccode};that.sendGeetestVerification(verifData)}),$(".verification").on("click",function(){if(!that.validateMoblie()){var isValidate=$(".verification").hasClass("is_validate");isValidate&&($(".loading-img").show(),captchaObj.verify())}})},RegForm.prototype.errorModal=function(num){$(".reg-error").text(this.error),$(".reg-error").fadeIn(2e3,function(){setTimeout(function(){$(".reg-error").fadeOut(2e3)},2e3)}),num>=0&&$(".reg-ul li").eq(num).addClass("orange").siblings("li").removeClass("orange")},RegForm}();module.exports=new RegForm});